echo "ğŸ” Running pre-commit checks..."

# AUTO-CLEANUP: Move misplaced files
echo "ğŸ“ Auto-organizing files..."

# Move stray .md files to docs/
for f in *.md; do
  [ -f "$f" ] || continue
  case "$f" in
    README.md) ;; # Keep at root
    CHANGELOG.md) mv "$f" docs/ 2>/dev/null && echo "  Moved $f â†’ docs/" ;;
    ANALYSE_*|RAPPORT_*) mv "$f" docs/reports/ 2>/dev/null && echo "  Moved $f â†’ docs/reports/" ;;
    GUIDE_*|DEMARRAGE_*) mv "$f" docs/guides/ 2>/dev/null && echo "  Moved $f â†’ docs/guides/" ;;
    ROADMAP*|CONTEXTE_*) mv "$f" docs/project/ 2>/dev/null && echo "  Moved $f â†’ docs/project/" ;;
    INDEX*|*PLAN*|*TASK*) mv "$f" docs/plans/ 2>/dev/null && echo "  Moved $f â†’ docs/plans/" ;;
    *) mv "$f" docs/ 2>/dev/null && echo "  Moved $f â†’ docs/" ;;
  esac
done

# Move stray scripts to scripts/
for f in *.py; do
  [ -f "$f" ] || continue
  case "$f" in
    conftest.py|setup.py) ;; # Keep at root
    test_*) mv "$f" tests/ 2>/dev/null && echo "  Moved $f â†’ tests/" ;;
    *) mv "$f" scripts/ 2>/dev/null && echo "  Moved $f â†’ scripts/" ;;
  esac
done

# Delete garbage
rm -f nul commit-message.txt *.log 2>/dev/null

# Format Python code
echo "ğŸ“ Formatting Python code..."
python -m black . --quiet

# Check Python code quality
echo "ğŸ” Checking Python code quality..."
python -m flake8 . --max-line-length=100 --extend-ignore=E203,W503 || echo "âš ï¸  Flake8 warnings"

# Run tests
if [ -d "tests" ]; then
  echo "ğŸ§ª Running tests..."
  python -m pytest -q || exit 1
fi

# Lint staged files
echo "âœ¨ Linting staged files..."
npx lint-staged

echo "âœ… Pre-commit checks passed!"
